<script>


    const xxx = async () => {
        alert('xxx: begin')
        try {
            location = await getLocation()
        } catch (error) {
            alert('xxx: ' + error)
        }
        alert('xxx: end')

    }



    const getLocation = () => new Promise((resolve, reject) => {
        try {
            navigator.permissions.query({
                name: 'geolocation'
            }).then(function (status) {
                console.log(status)
                if (status?.state === "granted" || status?.state === "prompt") {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition((position) => {

                            var lat = position?.coords?.latitude;
                            var long = position?.coords?.longitude;
                            var location = {
                                lat: lat,
                                long: long
                            }
                            currentPosition = location
                            resolve(location)
                        },
                            possitonError => {
                                resolve(null)
                            });
                    }
                    else resolve(null)
                }
                else resolve(null)
            });
        } catch (error) {
            resolve(null)
        }
    })

    xxx();


</script>
